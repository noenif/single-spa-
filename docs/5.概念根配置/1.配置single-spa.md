# é…ç½®single-spa

single-spaæ ¹é…ç½®åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

1. æ‰€æœ‰single-spa åº”ç”¨ç¨‹åºå…±äº«çš„æ ¹HTML æ–‡ä»¶ã€‚
2. è°ƒç”¨çš„ JavaScript [**singleSpa.registerApplication()**](https://single-spa.js.org/docs/api.html#registerapplication)ã€‚

æ‚¨çš„æ ¹é…ç½®ä»…ç”¨äºå¯åŠ¨single-spaåº”ç”¨ç¨‹åºã€‚

## ç´¢å¼•.htmlæ–‡ä»¶[#](https://single-spa.js.org/docs/configuration/#indexhtml-file)

çœ‹ [this example root config](https://github.com/polyglot-microfrontends/root-config/blob/master/src/index.ejs) å¯¹äºæ ¹ HTML æ–‡ä»¶çš„å¤–è§‚ã€‚

**ä½¿ç”¨ single-spa æ—¶æ‚¨ä¸å¿…ä½¿ç”¨ SystemJS**ï¼Œä½†è®¸å¤šç¤ºä¾‹å’Œæ•™ç¨‹ä¼šé¼“åŠ±æ‚¨è¿™æ ·åšï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨[independently deploy](https://single-spa.js.org/docs/separating-applications.html) æ‚¨çš„åº”ç”¨ç¨‹åºã€‚

## æ³¨å†Œåº”ç”¨ç¨‹åº[#](https://single-spa.js.org/docs/configuration/#registering-applications)

ä½ å¿…é¡»æ³¨å†Œ [applications](https://single-spa.js.org/docs/building-applications)ä½¿ç”¨ single-spaï¼Œå› æ­¤å®ƒçŸ¥é“å¦‚ä½•ä»¥åŠä½•æ—¶å¯åŠ¨ã€åŠ è½½ã€å®‰è£…å’Œå¸è½½æ¯ä¸ªåº”ç”¨ç¨‹åºã€‚æ³¨å†Œæœ€å¸¸å‘ç”Ÿåœ¨ single-spa é…ç½®å†…éƒ¨ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯ä»å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå†…æ³¨å†Œçš„ï¼Œåˆ™åº”ç”¨ç¨‹åºä¹‹é—´å°†ä¸ä¼šä¿æŒå±‚æ¬¡ç»“æ„ã€‚ç›¸åï¼Œåº”ç”¨ç¨‹åºå°†æ˜¯åŒçº§çš„ï¼Œå°†æ ¹æ®å®ƒä»¬è‡ªå·±çš„æ´»åŠ¨åŠŸèƒ½è¿›è¡Œå®‰è£…å’Œå¸è½½ã€‚

ä¸ºäº†æ³¨å†Œåº”ç”¨ç¨‹åºï¼Œè¯·è‡´ç”µ **registerApplication**åŠŸèƒ½ã€‚ä¾‹å­ï¼š

```javascript
// single-spa-config.js
import { registerApplication, start } from 'single-spa';

// Simple usage
registerApplication(
  'app2',
  () => import('src/app2/main.js'),
  (location) => location.pathname.startsWith('/app2'),
  { some: 'value' }
);

// Config with more expressive API
registerApplication({
  name: 'app1',
  app: () => import('src/app1/main.js'),
  activeWhen: '/app1',
  customProps: {
    some: 'value',
  }
});

start();
```

### ä½¿ç”¨å‚æ•°[#](https://single-spa.js.org/docs/configuration/#using-arguments)

#### åº”ç”¨åç§°[#](https://single-spa.js.org/docs/configuration/#application-name)

ç¬¬ä¸€ä¸ªè®ºç‚¹ **registerApplication** å¿…é¡»æ˜¯å­—ç¬¦ä¸²åç§°ã€‚

#### åŠ è½½å‡½æ•°æˆ–åº”ç”¨ç¨‹åº[#](https://single-spa.js.org/docs/configuration/#loading-function-or-application)

ç¬¬äºŒä¸ªè®ºç‚¹ **registerApplication** å¿…é¡»æ˜¯ä¸€ä¸ªè¿”å›æ‰¿è¯ºçš„å‡½æ•° [loading function](https://single-spa.js.org/docs/configuration/configuration#loading-function) æˆ–å·²è§£å†³çš„åº”ç”¨ç¨‹åºã€‚

##### åº”ç”¨ç¨‹åºä½œä¸ºç¬¬äºŒä¸ªå‚æ•°[#](https://single-spa.js.org/docs/configuration/#application-as-second-argument)

å¯¹äºç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨å·²è§£æçš„åº”ç”¨ç¨‹åºï¼Œå®ƒç”±å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„å¯¹è±¡ç»„æˆã€‚è¿™å…è®¸æ‚¨ä»å¦ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥åº”ç”¨ç¨‹åºæˆ–åœ¨æ‚¨çš„ single-spa-config ä¸­å®šä¹‰å†…è”åº”ç”¨ç¨‹åº

```javascript
const application = {
  bootstrap: () => Promise.resolve(), //bootstrap function
  mount: () => Promise.resolve(), //mount function
  unmount: () => Promise.resolve(), //unmount function
}
registerApplication('applicationName', application, activityFunction)

```

##### åŠ è½½åŠŸèƒ½[#](https://single-spa.js.org/docs/configuration/#loading-function)

ç¬¬äºŒä¸ªè®ºç‚¹ **registerApplication** å¿…é¡»æ˜¯ä¸€ä¸ªè¿”å›æ‰¿è¯ºçš„å‡½æ•°ï¼ˆæˆ– ["async function"](https://ponyfoo.com/articles/understanding-javascript-async-await)ï¼‰ã€‚å½“ç¬¬ä¸€æ¬¡åŠ è½½åº”ç”¨ç¨‹åºæ—¶ï¼Œå°†ä¸å¸¦å‚æ•°è°ƒç”¨è¯¥å‡½æ•°ã€‚è¿”å›çš„æ‰¿è¯ºå¿…é¡»ä¸åº”ç”¨ç¨‹åºä¸€èµ·è§£å†³ã€‚åŠ è½½å‡½æ•°æœ€å¸¸è§çš„å®ç°æ˜¯å¯¼å…¥è°ƒç”¨ï¼š **() => import('/path/to/application.js')**

#### æ´»åŠ¨åŠŸèƒ½[#](https://single-spa.js.org/docs/configuration/#activity-function)

ç¬¬ä¸‰ä¸ªè®ºæ® **registerApplication** å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œå‡½æ•°è¢«æä¾› **window.location**ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºåº”è¯¥å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶è¿”å›ä¸€ä¸ªçœŸå€¼ã€‚æœ€å¸¸è§çš„æ˜¯ï¼Œæ´»åŠ¨å‡½æ•°é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ¥ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€**window.location**/ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

å¦ä¸€ç§çœ‹å¾…è¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯ï¼Œsingle-spaæ˜¯ä¸€ç§é¡¶çº§è·¯ç”±å™¨ï¼Œå…¶è®¸å¤šåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„å­è·¯ç”±å™¨ã€‚

single-spa ä¼šåœ¨ä»¥ä¸‹åœºæ™¯ä¸‹è°ƒç”¨å„ä¸ªåº”ç”¨çš„activityå‡½æ•°ï¼š

- **hashchange** æˆ–è€… **popstate** äº‹ä»¶
- **pushState** æˆ–è€… **replaceState** å«åš
- [**triggerAppChange**](https://single-spa.js.org/docs/api#triggerappchange) api åœ¨ single-spa ä¸Šè¢«è°ƒç”¨
- æ¯å½“ **checkActivityFunctions** æ–¹æ³•è¢«è°ƒç”¨

#### è‡ªå®šä¹‰é“å…·[#](https://single-spa.js.org/docs/configuration/#custom-props)

å¯é€‰çš„ç¬¬å››ä¸ªå‚æ•° **registerApplication** æ˜¯ [custom props](https://single-spa.js.org/docs/building-applications/#custom-props)ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„single-spa ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚è‡ªå®šä¹‰é“å…·å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ã€‚ä½¿ç”¨åº”ç”¨ç¨‹åºåç§°å’Œå½“å‰è°ƒç”¨è‡ªå®šä¹‰ prop å‡½æ•°**window.location** ä½œä¸ºè®ºæ®ã€‚

### ä½¿ç”¨é…ç½®å¯¹è±¡[#](https://single-spa.js.org/docs/configuration/#using-configuration-object)

```javascript
singleSpa.registerApplication({
  name: 'myApp',
  app: () => import('src/myApp/main.js'),
  activeWhen: ['/myApp', (location) => location.pathname.startsWith('/some/other/path')],
  customProps: {
    some: 'value',
  },
});

singleSpa.registerApplication({
  name: 'myApp',
  app: () => import('src/myApp/main.js'),
  activeWhen: ['/myApp', (location) => location.pathname.startsWith('/some/other/path')],
  customProps: (name, location) => ({
    some: 'value',
  }),
});
```

#### é…ç½®æ–‡ä»¶å[#](https://single-spa.js.org/docs/configuration/#configname)

å¿…é¡»æ˜¯å­—ç¬¦ä¸²åç§°

#### é…ç½®æ–‡ä»¶[#](https://single-spa.js.org/docs/configuration/#configapp)

æ‚¨çš„åº”ç”¨ç¨‹åºçš„å®šä¹‰ï¼Œå¯ä»¥æ˜¯å…·æœ‰single-spa ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯åŠ è½½å‡½æ•°ï¼Œä¸arguments API ä¸Šçš„ç¬¬äºŒä¸ªå‚æ•°ç›¸åŒ

#### config.activeWhen[#](https://single-spa.js.org/docs/configuration/#configactivewhen)

å¯ä»¥æ˜¯æ´»åŠ¨å‡½æ•°ï¼Œå¦‚å‚æ•° APIã€è·¯å¾„å‰ç¼€æˆ–ä¸¤è€…å…¼æœ‰çš„æ•°ç»„ã€‚ç”±äºæœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯æŸ¥çœ‹**window.location** å¹¶å°† URL ä¸å‰ç¼€åŒ¹é…ï¼Œæˆ‘ä»¬å†³å®šä¸ºæ‚¨æ‰§è¡Œæ­¤æ“ä½œï¼

#### è·¯å¾„å‰ç¼€[#](https://single-spa.js.org/docs/configuration/#path-prefix)

è·¯å¾„å‰ç¼€å°†åŒ¹é…æ‚¨çš„ URL çš„å¼€å¤´ï¼Œå…è®¸å‰ç¼€ä¹‹åçš„æ‰€æœ‰å†…å®¹ã€‚ä¾‹å­ï¼š

- '/åº”ç”¨ç¨‹åº1'

  âœ… https://app.com/app1

  âœ… https://app.com/app1/anything/everything

  ğŸš« https://app.com/app2

- '/users/:userId/profile'

  âœ… https://app.com/users/123/profile

  âœ… https://app.com/users/123/profile/sub-profile/

  ğŸš« https://app.com/users//profile/sub-profile/

  ğŸš« https://app.com/users/profile/sub-profile/

- '/è·¯å¾„å/ï¼ƒ/å“ˆå¸Œ'

  âœ… https://app.com/pathname/#/hash

  âœ… https://app.com/pathname/#/hash/route/nested

  ğŸš« https://app.com/pathname#/hash/route/nested

  ğŸš« https://app.com/pathname#/another-hash

- ['/pathname/#/hash', '/app1']

  âœ… https://app.com/pathname/#/hash/route/nested

  âœ… https://app.com/app1/anything/everything

  ğŸš« https://app.com/pathname/app1

  ğŸš« https://app.com/app2

#### config.customProps[#](https://single-spa.js.org/docs/configuration/#configcustomprops)

å¯é€‰çš„ **customProps** ç‰©ä¸šæä¾› [custom props](https://single-spa.js.org/docs/building-applications/#custom-props)ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„single-spa ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚è‡ªå®šä¹‰é“å…·å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ã€‚ä½¿ç”¨åº”ç”¨ç¨‹åºåç§°å’Œå½“å‰è°ƒç”¨è‡ªå®šä¹‰ prop å‡½æ•°**window.location** ä½œä¸ºè®ºæ®ã€‚

## è°ƒç”¨ singleSpa.start()[#](https://single-spa.js.org/docs/configuration/#calling-singlespastart)

è¿™ [**start()** api](https://single-spa.js.org/docs/api#start) **å¿…é¡»**ç”±æ‚¨çš„å•ä¸ª spa é…ç½®è°ƒç”¨æ‰èƒ½å®é™…å®‰è£…åº”ç”¨ç¨‹åºã€‚å‰**start**è¢«è°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå°†è¢«åŠ è½½ï¼Œä½†ä¸ä¼šå¼•å¯¼/æŒ‚è½½/å¸è½½ã€‚çš„åŸå› **start**æ˜¯è®©ä½ æ§åˆ¶æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ç«‹å³æ³¨å†Œåº”ç”¨ç¨‹åºï¼ˆä»¥å¼€å§‹ä¸‹è½½æ´»åŠ¨åº”ç”¨ç¨‹åºçš„ä»£ç ï¼‰ï¼Œä½†åœ¨åˆå§‹ AJAX è¯·æ±‚ï¼ˆå¯èƒ½æ˜¯è·å–æœ‰å…³ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼‰å®Œæˆä¹‹å‰ä¸å®é™…å®‰è£…åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„æ€§èƒ½æ˜¯é€šè¿‡è°ƒç”¨**registerApplication** ç«‹å³ï¼Œä½†æ‰“ç”µè¯ **start** AJAX è¯·æ±‚å®Œæˆåã€‚

```javascript
//single-spa-config.js
import { start } from 'single-spa';

/* Calling start before registering apps means that single-spa can immediately mount apps, without
 * waiting for any initial setup of the single page app.
 */
start();

// Register applications....
```

## ä¸¤ä¸ªåŒæ—¶æ³¨å†Œçš„åº”ç”¨ç¨‹åºï¼Ÿï¼Ÿ[#](https://single-spa.js.org/docs/configuration/#two-registered-applications-simultaneously)

æ˜¯çš„ï¼Œè¿™æ˜¯å¯èƒ½çš„ã€‚å¦‚æœä½ åšå¾—å¯¹ï¼Œå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¯æ€•ã€‚ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œå®ƒçœŸçš„éå¸¸å¼ºå¤§ã€‚ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª**<div>** å¯¹äºæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿ä»–ä»¬æ°¸è¿œä¸ä¼šå°è¯•åŒæ—¶ä¿®æ”¹ç›¸åŒçš„ DOMã€‚

è¿™ **<div>** å°†éœ€è¦ä¸€ä¸ª **id** ä»¥å‰ç¼€å¼€å¤´ **single-spa-application:** ç„¶åæ˜¯æ‚¨çš„åº”ç”¨åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªåä¸º**app-name**ï¼Œä½ ä¼šåšä¸€ä¸ª **<div>** ç”¨èº«ä»½è¯ **single-spa-application:app-name**ã€‚

åŒ…å«å¤šä¸ªåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š

```
<div id="single-spa-application:app-name"></div>
<div id="single-spa-application:other-app"></div>å¤åˆ¶
```